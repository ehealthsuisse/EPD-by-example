<?xml version="1.0" encoding="UTF-8"?>
<soap:Envelope
	xmlns:soap="http://www.w3.org/2003/05/soap-envelope">
	<soap:Body>
		<RequestSecurityTokenResponseCollection
			xmlns="http://docs.oasis-open.org/ws-sx/ws-trust/200512"
			xmlns:ns3="http://docs.oasis-open.org/wss/2004/01/oasis-200401-wss-wssecurity-secext-1.0.xsd">
			<RequestSecurityTokenResponse>
				<TokenType>http://docs.oasis-open.org/wss/oasis-wss-saml-token-profile-1.1#SAMLV2.0
				</TokenType>
				<RequestedSecurityToken>

					<saml2:Assertion
						xmlns:saml2="urn:oasis:names:tc:SAML:2.0:assertion"
						xmlns:del="urn:oasis:names:tc:SAML:2.0:conditions:delegation"
						xmlns:xsd="http://www.w3.org/2001/XMLSchema"
						xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
						ID="_2cfcc382-7e60-44e0-99b5-18e3f718cbc6"
						IssueInstant="2018-03-28T09:02:43.155Z" Version="2.0"
						xsi:type="saml2:AssertionType">
						<saml2:Issuer>xua.hin.ch</saml2:Issuer>

						<!-- Signature provided by the X-Assertion Provider -->
						<ds:Signature xmlns:ds="http://www.w3.org/2000/09/xmldsig#">
							<ds:SignedInfo>
								<ds:CanonicalizationMethod
									Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#"/>
								<ds:SignatureMethod
									Algorithm="http://www.w3.org/2001/04/xmldsig-more#rsa-sha256"/>
								<ds:Reference URI="#_2cfcc382-7e60-44e0-99b5-18e3f718cbc6">
									<ds:Transforms>
										<ds:Transform
											Algorithm="http://www.w3.org/2000/09/xmldsig#enveloped-signature"/>
										<ds:Transform
											Algorithm="http://www.w3.org/2001/10/xml-exc-c14n#">
											<ec:InclusiveNamespaces
												xmlns:ec="http://www.w3.org/2001/10/xml-exc-c14n#"
												PrefixList="del xsd"/>
										</ds:Transform>
									</ds:Transforms>
									<ds:DigestMethod
										Algorithm="http://www.w3.org/2001/04/xmlenc#sha256"/>
									<ds:DigestValue>UyqzdpLkYUMscBO0bEP6FwnKnlUscVCD70GL3uP6aSY=
									</ds:DigestValue>
								</ds:Reference>
							</ds:SignedInfo>
							<ds:SignatureValue>
								KedJuTob5gtvYx9qM3k3gm7kbLBwVbEQRl26S2tmXjqNND7MRGtoew==
							</ds:SignatureValue>
						</ds:Signature>

						<saml2:Subject>
							<saml2:NameID
								Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"
								NameQualifier="urn:gs1:gln">
								2000000090201
							</saml2:NameID>
							<saml2:SubjectConfirmation
								Method="urn:oasis:names:tc:SAML:2.0:cm:bearer">
								<saml2:NameID
									Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent"
									NameQualifier="urn:e-health-suisse:technical-user-id">
									urn:oid:1.3.6.1.4.1.343
								</saml2:NameID>
							</saml2:SubjectConfirmation>
						</saml2:Subject>

						<!-- the delegate condition -->
						<saml2:Conditions NotBefore="2018-03-28T09:02:43.155Z"
							NotOnOrAfter="2018-03-28T09:32:43.155Z">
							<saml2:AudienceRestriction>
								<saml2:Audience>urn:e-health-suisse:token-audience:all-communities
								</saml2:Audience>
							</saml2:AudienceRestriction>
							<saml2:Condition xsi:type="del:DelegationRestrictionType">
								<del:Delegate>
									<saml2:NameID
										NameQualifier="urn:e-health-suisse:technical-user-id"
										Format="urn:oasis:names:tc:SAML:2.0:nameid-format:persistent">urn:oid:1.3.6.1.4.1.343
									</saml2:NameID>
								</del:Delegate>
							</saml2:Condition>
						</saml2:Conditions>

						<saml2:AuthnStatement
							AuthnInstant="2018-03-28T09:02:43.155Z"
							SessionNotOnOrAfter="2018-03-28T09:12:43.154Z">
							<saml2:AuthnContext>
								<saml2:AuthnContextClassRef>urn:oasis:names:tc:SAML:2.0:ac:classes:unspecified
								</saml2:AuthnContextClassRef>
							</saml2:AuthnContext>
						</saml2:AuthnStatement>

						<!-- the attributes claimed in the request or queried by the assertion provider -->
						<saml2:AttributeStatement>

							<!-- role of the principal -->
							<saml2:Attribute
								Name="urn:oasis:names:tc:xacml:2.0:subject:role"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified">
								<saml2:AttributeValue>
									<Role xmlns="urn:hl7-org:v3" code="HCP"
										codeSystem="2.16.756.5.30.1.127.3.10.6"
										codeSystemName="eHealth Suisse EPR Akteure"
										displayName="Behandelnde(r)" xsi:type="CE"/>
								</saml2:AttributeValue>
							</saml2:Attribute>

							<saml2:Attribute
								Name="urn:oasis:names:tc:xspa:1.0:subject:purposeofuse"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified">
								<saml2:AttributeValue>
									<PurposeOfUse xmlns="urn:hl7-org:v3" code="AUTO"
										codeSystem="2.16.756.5.30.1.127.3.10.5"
										codeSystemName="eHealth Suisse Verwendungszweck"
										displayName="Technical User Access" xsi:type="CE"/>
								</saml2:AttributeValue>
							</saml2:Attribute>

							<saml2:Attribute
								Name="urn:oasis:names:tc:xacml:2.0:resource:resource-id"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified">
								<saml2:AttributeValue xsi:type="xsd:string">305000^^^&amp;2.16.756.5.30.1.109.6.5.3.1.1&amp;ISO
								</saml2:AttributeValue>
							</saml2:Attribute>

							<!-- claims related to the principal identity -->
							<saml2:Attribute
								Name="urn:oasis:names:tc:xspa:1.0:subject:subject-id"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified">
								<saml2:AttributeValue xsi:type="xsd:string">Max
									Musterverantwortlicher
								</saml2:AttributeValue>
							</saml2:Attribute>

							<!-- technical user have write only access, thus groups MAY be empty -->
							<saml2:Attribute
								Name="urn:oasis:names:tc:xspa:1.0:subject:organization"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"/>

							<saml2:Attribute
								Name="urn:oasis:names:tc:xspa:1.0:subject:organization-id"
								NameFormat="urn:oasis:names:tc:SAML:2.0:attrname-format:unspecified"/>
							<saml2:AttributeValue xsi:type="xsd:string"/>

						</saml2:AttributeStatement>
					</saml2:Assertion>
				</RequestedSecurityToken>

			</RequestSecurityTokenResponse>

		</RequestSecurityTokenResponseCollection>
	</soap:Body>
</soap:Envelope>
